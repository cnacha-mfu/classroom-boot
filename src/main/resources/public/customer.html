<!DOCTYPE html>
<html>
<head>
    <title>Customer Management</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</head>
<body>
    <h1>Customer Management</h1>

    <h2>Create New Customer</h2>
    <form id="customerForm">
        <input type="hidden" id="customerId"> 
        <label for="firstname">First Name:</label>
        <input type="text" id="firstname" name="firstname" required><br><br>

        <label for="lastname">Last Name:</label>
        <input type="text" id="lastname" name="lastname" required><br><br>

        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <button type="submit" id="createOrUpdateButton">Create Customer</button>
    </form>

    <h2>All Customers</h2>
    <div id="customerList">
        <!-- Customer data will be displayed here -->
    </div>

    <script>
        $(document).ready(function() {
            fetchCustomers();

            // Function to fetch and display all customers
            function fetchCustomers() {
                $.ajax({
                    url: 'http://localhost:8080/customers', // Replace with your backend URL
                    type: 'GET',
                    success: function(data) {
                        $('#customerList').empty();
                        $.each(data, function(index, customer) {
                            $('#customerList').append(`
                                <div data-customer-id="${customer.id}">
                                    <b>First Name:</b> ${customer.firstname}<br>
                                    <b>Last Name:</b> ${customer.lastname}<br>
                                    <b>Age:</b> ${customer.age}<br>
                                    <b>Email:</b> ${customer.email}<br>
                                    <button class="edit-customer">Edit</button> 
                                    <button class="delete-customer">Delete</button> 
                                </div>
                                <hr>
                            `);
                        });

                        // Attach click handlers AFTER creating the buttons
                        $('.delete-customer').click(function() {
                            const customerId = $(this).closest('div').data('customer-id');
                            deleteCustomer(customerId);
                        });

                        $('.edit-customer').click(function() {
                            const customerId = $(this).closest('div').data('customer-id');
                            editCustomer(customerId);
                        });
                    },
                    error: function(error) {
                        $('#customerList').empty();
                        console.error('Error fetching customers:', error);
                    }
                });
            }

            // Function to delete a customer
            function deleteCustomer(id) {
                if (confirm("Are you sure you want to delete this customer?")) {
                    $.ajax({
                        url: 'http://localhost:8080/customers/'+id, // Replace with your backend URL
                        type: 'DELETE',
                        success: function() {
                            console.log('Customer deleted successfully');
                            fetchCustomers();
                        },
                        error: function(error) {
                            console.error('Error deleting customer:', error);
                        }
                    });
                }
            }

            // Function to populate the form with customer data for editing
            function editCustomer(id) {
                $.ajax({
                    url: `http://localhost:8080/customers/${id}`, // Replace with your backend URL
                    type: 'GET',
                    success: function(customer) {
                        $('#customerId').val(customer.id);
                        $('#firstname').val(customer.firstname);
                        $('#lastname').val(customer.lastname);
                        $('#age').val(customer.age);
                        $('#email').val(customer.email);
                        $('#createOrUpdateButton').text('Update Customer');
                    },
                    error: function(error) {
                        console.error('Error fetching customer details:', error);
                    }
                });
            }

            // Handle form submission (both create and update)
            $('#customerForm').submit(function(event) {
                event.preventDefault();

                var customerId = $('#customerId').val();
                var formData = {
                    firstname: $('#firstname').val(),
                    lastname: $('#lastname').val(),
                    age: parseInt($('#age').val()),
                    email: $('#email').val()
                };

                var method = customerId ? 'PUT' : 'POST'; 
                var url = customerId ? `http://localhost:8080/customers/${customerId}` : 'http://localhost:8080/customers'; // Replace with your backend URL

                $.ajax({
                    url: url,
                    type: method,
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(data) {
                        console.log(customerId ? 'Customer updated successfully' : 'Customer created successfully', data);
                        $('#customerForm')[0].reset();
                        $('#createOrUpdateButton').text('Create Customer');
                        $('#customerId').val(''); // Clear the hidden ID field
                        fetchCustomers();
                    },
                    error: function(error) {
                        console.error(customerId ? 'Error updating customer' : 'Error creating customer', error);
                    }
                });
            });
        });
    </script>
</body>
</html>
